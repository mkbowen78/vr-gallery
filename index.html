<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Kevin's 360&deg; A-Frame Gallery</title>
    <meta name="description" content="Kevin's 360&deg; A-Frame Gallery">

<!-- voice rec -->
    <script src="//cdnjs.cloudflare.com/ajax/libs/annyang/2.6.0/annyang.min.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script>
    "use strict";

    // first we make sure annyang started succesfully
    if (annyang) {

      // define the functions our commands will run.
      var hello = function() {
        $("#hello").slideDown("slow");
        scrollTo("#section_hello");
      };

      var showFlickr = function(tag) {
        $('#flickrGallery').show();
        $('#flickrLoader p').text('Searching for '+tag).fadeIn('fast');
        var url = '//api.flickr.com/services/rest/?method=flickr.photos.search&api_key=98346ee73ce458c1ee3bf50de52c914f&sort=interestingness-desc&per_page=9&format=json&callback=jsonFlickrApi&tags='+tag;
        $.ajax({
          type: 'GET',
          url: url,
          async: false,
          jsonpCallback: 'jsonFlickrApi',
          contentType: "application/json",
          dataType: 'jsonp'
        });
        scrollTo("#section_image_search");
      };

      var jsonFlickrApi = function(results) {
        $('#flickrLoader p').fadeOut('slow');
        var photos = results.photos.photo;
        $.each(photos, function(index, photo) {
          $(document.createElement("img"))
            .attr({ src: '//farm'+photo.farm+'.staticflickr.com/'+photo.server+'/'+photo.id+'_'+photo.secret+'_s.jpg' })
            .addClass("flickrGallery")
            .appendTo(flickrGallery);
        });
      };

      var getStarted = function() {
        window.location.href = 'https://github.com/TalAter/annyang';
      }

      // define our commands.
      // * The key is the phrase you want your users to say.
      // * The value is the action to do.
      //   You can pass a function, a function name (as a string), or write your function as part of the commands object.
      var commands = {
        'hello (there)':        hello,
        'show me *search':      showFlickr,
        'let\'s get started':   getStarted,
      };

      // OPTIONAL: activate debug mode for detailed logging in the console
      annyang.debug();

      // Add voice commands to respond to
      annyang.addCommands(commands);

      // OPTIONAL: Set a language for speech recognition (defaults to English)
      // For a full list of language codes, see the documentation:
      // https://github.com/TalAter/annyang/blob/master/docs/FAQ.md#what-languages-are-supported
      annyang.setLanguage('en');

      // Start listening. You can call this here, or attach this call to an event, button, etc.
      annyang.start();
    } else {
      $(document).ready(function() {
        $('#unsupported').fadeIn('fast');
      });
    }

    // var scrollTo = function(identifier, speed) {
    //   $('html, body').animate({
    //       scrollTop: $(identifier).offset().top
    //   }, speed || 1000);
    // }
    </script>
<!-- voice rec -->



    <script src="https://aframe.io/releases/0.5.0/aframe.min.js"></script>
    <script src="https://npmcdn.com/aframe-animation-component@3.0.1"></script>
    <script src="https://npmcdn.com/aframe-event-set-component@3.0.1"></script>
    <script src="https://npmcdn.com/aframe-layout-component@3.0.1"></script>
    <script src="https://npmcdn.com/aframe-template-component@3.1.1"></script>
    <script src="components/set-image.js"></script>

  </head>
  <body>
    <a-scene>
      <a-assets>
        <img id="beach" crossorigin="anonymous" src="gallery/coastline.jpg">
        <img id="beach-thumb" crossorigin="anonymous" src="gallery/thumbs-beach.png">
        
        <img id="farm" crossorigin="anonymous" src="gallery/farm-field.jpg">
        <img id="farm-thumb" crossorigin="anonymous" src="gallery/thumbs-farm.png">

        <img id="hoover" crossorigin="anonymous" src="gallery/hoover-dam.jpg">
        <img id="hoover-thumb" crossorigin="anonymous" src="gallery/thumbs-hoover.png">

        <img id="ocean" crossorigin="anonymous" src="gallery/underwater.jpg">
        <img id="ocean-thumb" crossorigin="anonymous" src="gallery/thumbs-ocean.png">

        <img id="peak" crossorigin="anonymous" src="gallery/mountains.jpg">
        <img id="peak-thumb" crossorigin="anonymous" src="gallery/thumbs-peak.png">

        <audio id="click-sound" crossorigin="anonymous" src="https://cdn.aframe.io/360-image-gallery-boilerplate/audio/click.ogg"></audio>


    <script>

      //-------- start commands
    var commands = {
      // annyang will capture anything after a splat (*) and pass it to the function.
      // e.g. saying "Show me Batman and Robin" is the same as calling showFlickr('Batman and Robin');
      'show me *tag': showFlickr,

      // By defining a part of the following command as optional, annyang will respond to both:
      // "say hello to my little friend" as well as "say hello friend"
      'say hello (to my little) friend': greeting
    };

    var showFlickr = function(tag) {
      var url = 'http://api.flickr.com/services/rest/?tags='+tag;
      $.getJSON(url);
    }

    var calculateStats = function(month) {
      $('#stats').text('Statistics for '+month);
    }

    var greeting = function() {
      $('#greeting').text('Hello!');
    }
    </script>
    <!-- end of voice rec functions />


        <!-- Image link template to be reused. -->
        <script id="link" type="text/html">
          <a-entity class="link"
            geometry="primitive: plane; height: 1; width: 1"
            material="shader: flat; src: ${thumb}"
            event-set__1="_event: mousedown; scale: 1 1 1"
            event-set__2="_event: mouseup; scale: 1.5 1.5 1"
            event-set__3="_event: mouseenter; scale: 1.5 1.5 1"
            event-set__4="_event: mouseleave; scale: 1 1 1"
            set-image="on: click; target: #image-360; src: ${src}"
            sound="on: click; src: #click-sound"></a-entity>
        </script>
      </a-assets>

      <!-- 360-degree image. -->
      <a-sky id="image-360" radius="10" src="#city"></a-sky>

      <!-- Image links. -->
      <a-entity id="links" layout="type: line; margin: 1.5" position="-3 -1 -4">
        <a-entity template="src: #link" data-src="#beach" data-thumb="#beach-thumb"></a-entity>
        <a-entity template="src: #link" data-src="#farm" data-thumb="#farm-thumb"></a-entity>
        <a-entity template="src: #link" data-src="#hoover" data-thumb="#hoover-thumb"></a-entity>
        <a-entity template="src: #link" data-src="#ocean" data-thumb="#ocean-thumb"></a-entity>
        <a-entity template="src: #link" data-src="#peak" data-thumb="#peak-thumb"></a-entity>
      </a-entity>

      <!-- Camera + cursor. -->
      <a-entity camera look-controls>
        <a-cursor id="cursor"
          animation__click="property: scale; startEvents: click; from: 0.1 0.1 0.1; to: 1 1 1; dur: 150"
          animation__fusing="property: fusing; startEvents: fusing; from: 1 1 1; to: 0.1 0.1 0.1; dur: 1500"
          event-set__1="_event: mouseenter; color: springgreen"
          event-set__2="_event: mouseleave; color: black"
          fuse="true"
          raycaster="objects: .link"></a-cursor>
      </a-entity>
    </a-scene>
  </body>
</html>